    SELECT /*+PARALLEL (18)*/
DISTINCT A1.FECHA,A1.PPCOLLID,A1.PPACCT,A1.CUENTA, SUM(DISTINCT A1.CUENTAS), SUM(A1.PAGOS),A1.PPAMT, SUM(A1.IMP_PAGO)
FROM(
    SELECT DISTINCT (PMTFIL.PMTDDESC) AS UNIQ, TRUNC(PTPSCHED.PPDUE) AS FECHA, PTPSCHED.PPCOLLID, PTPSCHED.PPACCT,
    CASE
    WHEN substr(PTPSCHED.PPACCT,1,5) = '00000' THEN substr(PTPSCHED.PPACCT,1,11) ||''||'****'||''|| substr(PTPSCHED.PPACCT,16,4)
    WHEN substr(PTPSCHED.PPACCT,1,5) = '00014' THEN substr(PTPSCHED.PPACCT,1,9) ||''||'******'||''|| substr(PTPSCHED.PPACCT,16,4)
    WHEN substr(PTPSCHED.PPACCT,1,5) = '00041' THEN substr(PTPSCHED.PPACCT,1,9) ||''||'******'||''|| substr(PTPSCHED.PPACCT,16,4)
    WHEN substr(PTPSCHED.PPACCT,1,5) = '00040' THEN substr(PTPSCHED.PPACCT,1,9) ||''||'******'||''|| substr(PTPSCHED.PPACCT,16,4)
    WHEN substr(PTPSCHED.PPACCT,1,5) = '00064' THEN substr(PTPSCHED.PPACCT,1,9) ||''||'******'||''|| substr(PTPSCHED.PPACCT,16,4)
    ELSE '0' END AS CUENTA,

    COUNT(DISTINCT PMTFIL.PMACCT) AS CUENTAS , COUNT(PMTFIL.PMTDDESC)AS PAGOS, PTPSCHED.PPAMT, SUM (PMTFIL.PMTAMT) IMP_PAGO
    FROM rcvry.PMTFIL, rcvry.DELQMST, rcvry.PTPSCHED
    WHERE ((PTPSCHED.PPACCTG in ('6','5'))
    AND (DELQMST.DMACCTG in ('6','5'))
    AND (PMTFIL.PMACCTG in ('6','5'))
    AND (PTPSCHED.PPFLAG = 'C')
    AND (trunc(PTPSCHED.PPDUE) BETWEEN trunc(to_date('01/09/2025','dd/mm/yyyy')) AND trunc(to_date(SYSDATE-1)))
    AND (trunc(PMTFIL.PMTDATE) BETWEEN trunc(PTPSCHED.PPMADE) AND trunc(PTPSCHED.PPDUE)))
    AND (PTPSCHED.PPCOLLID LIKE 'i7%' OR PTPSCHED.PPCOLLID LIKE 'i5302%')
    AND (PMTFIL.PMQUE NOT LIKE 'RCA%' OR PMTFIL.PMQUE NOT LIKE 'NOQ%' OR PMTFIL.PMQUE NOT LIKE 'RC%')
    AND PTPSCHED.PPACCTG = DELQMST.DMACCTG
    AND PTPSCHED.PPACCT = DELQMST.DMACCT
    AND DELQMST.DMACCTG = PMTFIL.PMACCTG
    AND DELQMST.DMACCT = PMTFIL.PMACCT
    GROUP BY trunc(PTPSCHED.PPDUE), PTPSCHED.PPCOLLID, PTPSCHED.PPACCT, PTPSCHED.PPAMT,(PMTFIL.PMTDDESC))A1
GROUP BY A1.FECHA,A1.PPCOLLID,  A1.PPACCT,A1.CUENTA,A1.PPAMT
ORDER BY A1.FECHA ASC


/


SELECT /*+PARALLEL (18)*/
date1, workeddate1, name_1, nvl(workedAccts,0) workedAccts, nvl(productiveAccts,0) productiveAccts, nvl((productiveAccts / workedAccts),0) percProductiveAccts, nvl(ppGeneradas,0) ppGeneradas, nvl((ppGeneradas / productiveAccts),0) percPPGeneradas, nvl(totPPAccts,0) totPPAccts, nvl(keptPPAccts,0) keptPPAccts, nvl((keptPPAccts / totPPAccts),0) percKeptPPAcctsVsTotPPAccts, nvl(brokenppaccts,0) brokenppaccts, nvl((brokenPPAccts / totPPAccts),0) percBrokPPAcctsVsTotPPAccts
FROM

(SELECT distinct trunc(ACTFIL.ACACTDTE) date1, ACTFIL.ACCIDNAM name_1
FROM rcvry.ACTFIL
WHERE TRUNC(ACTFIL.ACACTDTE) BETWEEN TRUNC(TO_DATE('01/09/2025', 'dd/mm/yyyy'))AND TRUNC(TO_DATE(SYSDATE-1))
AND (ACCIDNAM like 'i7%' or ACCIDNAM like 'i5302%')

union

SELECT distinct trunc(PTPSCHED.PPDUE) date1, PTPSCHED.PPCOLLID
FROM rcvry.PTPSCHED
WHERE TRUNC(PTPSCHED.PPDUE) BETWEEN TRUNC(TO_DATE('01/09/2025', 'dd/mm/yyyy'))AND TRUNC(TO_DATE(SYSDATE-1))
AND (PPCOLLID like 'i7%' or PPCOLLID like 'i5302%')) date_1

LEFT OUTER JOIN

(SELECT trunc(ACTFIL.ACACTDTE) workeddate1, COLLID.CLCOLLID workedCollid, COUNT(DELQMST.DMACCT) workedAccts
FROM rcvry.ACTVERTB, rcvry.DELQMST, rcvry.ACTFIL, rcvry.COLLID
WHERE ((TRUNC(ACTFIL.ACACTDTE) BETWEEN TRUNC(TO_DATE('01/09/2025', 'dd/mm/yyyy'))AND TRUNC(TO_DATE(SYSDATE-1)))
AND(COLLID.CLUTYPE in ('1','2'))
AND(ACTVERTB.AVTYPE = 'R')
AND(ACTFIL.ACSEQNUM = '1'))
AND (ACCIDNAM like 'i7%' or ACCIDNAM like 'i5302%')
AND COLLID.CLCOLLID = ACTFIL.ACCIDNAM
AND ACTFIL.ACACCTG = DELQMST.DMACCTG
AND ACTFIL.ACACCT = DELQMST.DMACCT
AND ACTFIL.ACRCCODE = ACTVERTB.AVCODE
AND DELQMST.DMACCTG = ACTVERTB.AVACCTG
GROUP BY trunc(ACTFIL.ACACTDTE), COLLID.CLCOLLID) worked

ON date1 = workeddate1
and name_1 = workedCollid

LEFT OUTER JOIN

(SELECT TRUNC(ACTFIL.ACACTDTE) workeddate2, COLLID.CLCOLLID productiveCollid, COUNT(DELQMST.DMACCT) productiveAccts
FROM rcvry.ACTVERTB, rcvry.DELQMST, rcvry.ACTFIL, rcvry.COLLID
WHERE ((TRUNC(ACTFIL.ACACTDTE) BETWEEN TRUNC(TO_DATE('01/09/2025', 'dd/mm/yyyy'))AND TRUNC(TO_DATE(SYSDATE-1)))
AND(COLLID.CLUTYPE in ('1','2'))
AND (ACTVERTB.AVTYPE = 'R')
AND(ACTFIL.ACSEQNUM = '1')
AND (ACTVERTB.avcode not in ('PG'))
AND (ACTVERTB.avcntflg = 1))
AND (ACCIDNAM like 'i7%' or ACCIDNAM like 'i5302%')
AND COLLID.CLCOLLID = ACTFIL.ACCIDNAM
AND ACTFIL.ACACCTG = DELQMST.DMACCTG
AND ACTFIL.ACACCT = DELQMST.DMACCT
AND ACTFIL.ACRCCODE = ACTVERTB.AVCODE
AND DELQMST.DMACCTG = ACTVERTB.AVACCTG
GROUP BY TRUNC(ACTFIL.ACACTDTE), COLLID.CLCOLLID) productive

ON workedCollid = productiveCollid
AND workeddate1 = workeddate2

LEFT OUTER JOIN

(SELECT TRUNC(ACTFIL.ACACTDTE) workeddate3, COLLID.CLCOLLID ppGenCollid, COUNT(DELQMST.DMACCT) ppGeneradas
FROM rcvry.ACTVERTB, rcvry.DELQMST, rcvry.ACTFIL, rcvry.COLLID
WHERE ((TRUNC(ACTFIL.ACACTDTE) BETWEEN TRUNC(TO_DATE('01/09/2025', 'dd/mm/yyyy'))AND TRUNC(TO_DATE(SYSDATE-1)))
AND(COLLID.CLUTYPE in ('1','2'))
AND (ACTVERTB.AVTYPE = 'R')
AND(ACTFIL.ACSEQNUM = '1')
AND (ACTVERTB.avcode = 'PP')
AND (ACTVERTB.avcntflg = 1))
AND (ACCIDNAM like 'i7%' or ACCIDNAM like 'i5302%')
AND COLLID.CLCOLLID = ACTFIL.ACCIDNAM
AND ACTFIL.ACACCTG = DELQMST.DMACCTG
AND ACTFIL.ACACCT = DELQMST.DMACCT
AND ACTFIL.ACRCCODE = ACTVERTB.AVCODE
AND DELQMST.DMACCTG = ACTVERTB.AVACCTG
GROUP BY TRUNC(ACTFIL.ACACTDTE), COLLID.CLCOLLID) ppGen

ON workedCollid = ppGenCollid
AND workeddate1 = workeddate3

LEFT OUTER JOIN

(SELECT TRUNC(PTPSCHED.PPDUE) workeddate4, COLLID.CLCOLLID totPPCollid, COUNT(DELQMST.DMACCT) totPPAccts
FROM rcvry.DELQMST, rcvry.COLLID, rcvry.PTPSCHED
WHERE ((TRUNC(PTPSCHED.PPDUE) BETWEEN TRUNC(TO_DATE('01/09/2025', 'dd/mm/yyyy'))AND TRUNC(TO_DATE(SYSDATE-1)))
AND(COLLID.CLUTYPE in ('1','2'))
AND (PTPSCHED.PPFLAG IN ('C', 'R')))
AND (PPCOLLID like 'i7%' or PPCOLLID like 'i5302%')
AND COLLID.CLCOLLID = PTPSCHED.PPCOLLID
AND PTPSCHED.PPACCTG = DELQMST.DMACCTG
AND PTPSCHED.PPACCT = DELQMST.DMACCT
GROUP BY TRUNC(PTPSCHED.PPDUE), COLLID.CLDEPT, COLLID.CLCOLLID) totPP

ON name_1 = totPPCollid
AND date1 = workeddate4

LEFT OUTER JOIN

(SELECT distinct   TRUNC ( PTPSCHED.PPDUE) workeddate5, COLLID.CLCOLLID keptPPCollid, COUNT( distinct PMTFIL.PMACCT) keptPPAccts
FROM rcvry.COLLID, rcvry.PTPSCHED, rcvry.PMTFIL
WHERE ((TRUNC(PTPSCHED.PPDUE) BETWEEN TRUNC(TO_DATE('01/09/2025', 'dd/mm/yyyy'))AND TRUNC(TO_DATE(SYSDATE-1)))
and (trunc(PMTFIL.PMTDATE) BETWEEN trunc(PTPSCHED.PPMADE) and trunc(PTPSCHED.PPDUE))
AND(COLLID.CLUTYPE in ('1','2'))
AND (PTPSCHED.PPFLAG = 'C'))
AND (PPCOLLID like 'i7%' or PPCOLLID like 'i5302%')
AND PTPSCHED.PPCOLLID = COLLID.CLCOLLID
AND PTPSCHED.PPACCT=PMTFIL.PMACCT
AND PTPSCHED.PPACCTG=PMTFIL.PMACCTG
GROUP BY TRUNC(PTPSCHED.PPDUE), COLLID.CLCOLLID, COLLID.CLDEPT) keptPP
ON name_1 = keptPPCollid
AND date1 = workeddate5

LEFT OUTER JOIN

(SELECT TRUNC(PTPSCHED.PPDUE) workeddate6, COLLID.CLCOLLID brokenPPCollid, COUNT(PTPSCHED.PPACCT) brokenPPAccts
FROM rcvry.COLLID, rcvry.PTPSCHED
WHERE ((TRUNC(PTPSCHED.PPDUE) BETWEEN TRUNC(TO_DATE('01/09/2025', 'dd/mm/yyyy'))AND TRUNC(TO_DATE(SYSDATE-1)))
AND(COLLID.CLUTYPE in ('1','2'))
AND (PTPSCHED.PPFLAG = 'R'))
AND (PPCOLLID like 'i7%' or PPCOLLID like 'i5302%')
AND PTPSCHED.PPCOLLID = COLLID.CLCOLLID
GROUP BY TRUNC(PTPSCHED.PPDUE), COLLID.CLCOLLID, COLLID.CLDEPT) brokenPP

ON totPPCollid = brokenPPCollid
AND workeddate4 = workeddate6

where (name_1 like 'i7%' or name_1 like 'i5302%')
order by 1, 2 DESC 
